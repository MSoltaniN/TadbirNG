import { ChangeDetectorRef, Component, ElementRef,Input,NgZone, OnInit, Renderer2, ViewChild } from '@angular/core';
import { TranslateService } from '@ngx-translate/core';
import { DialogService } from '@progress/kendo-angular-dialog';
import { GridComponent } from '@progress/kendo-angular-grid';
import { SettingService } from '@sppc/config/service';
import { AutoGeneratedGridComponent, Filter} from '@sppc/shared/class';
import { BrowserStorageService, GridService, MetaDataService } from '@sppc/shared/services';
import { UserValueApi } from '@sppc/shared/services/api/userValueApi';
import { UserValueService } from '@sppc/shared/services/userValue.service';
import { ToastrService } from 'ngx-toastr';
import { UserValueComponent } from './user-value.component';

@Component({
  selector: 'user-value-filter',
  templateUrl: './asd.html',
  styles: [`
  
  `]
})
export class UserValueFilterComponent extends AutoGeneratedGridComponent implements OnInit {

  constructor(
    public toastrService: ToastrService,
    public translate: TranslateService,
    public gridService: GridService,
    public bStorageService: BrowserStorageService,
    public cdref: ChangeDetectorRef,
    public renderer: Renderer2,
    public metadata: MetaDataService,
    private userValueService: UserValueService,
    public dialogService: DialogService,
    public settingService: SettingService,
    public ngZone: NgZone,
    public elem: ElementRef,
  ) {
    super(
      toastrService,
      translate,
      gridService,
      renderer,
      metadata,
      settingService,
      bStorageService,
      cdref,
      ngZone,
      elem,
      UserValueApi.Categories,
      UserValueApi.CategoryValues
    );
  }

  @Input() parentComponent;
  bankNameFilter = false;
  userValueFilter: Filter[];
  searchValue: string;

  ngOnInit(): void {
      console.log('gfghghhhhhhhhhhhhhhhhhh');
      
  }
  
  // Events
  onBankNameFilterClick(e) {
    setTimeout(() => {
      if (this.bankNameFilter) {
        if (this.userValueFilter?.length) {
          this.defaultFilter = this.userValueFilter;
          this.reloadGrid();
        }
      } else {
        if (this.defaultFilter?.length) {
          this.defaultFilter = [];
          this.reloadGrid();
        }
      }
    }, 0);
  }

  openFilterDialog() {
    this.dialogRef = this.dialogService.open({
      title: this.getText("UserValueFilter.Title"),
      content: UserValueComponent
    });
    this.dialogModel = this.dialogRef.content.instance;
    this.dialogModel.categoryId = '1';
    this.dialogModel.dialogMode = true;
    this.editDataItem = undefined;

    if (this.reportFilter) {
      this.dialogModel.filter = JSON.parse(JSON.stringify(this.reportFilter));
    }

    if (this.reportQuickFilter) {
      this.dialogModel.quickFilter = JSON.parse(
        JSON.stringify(this.reportQuickFilter)
      );
    }

    this.dialogRef.content.instance.result.subscribe((result) => {
      if (result) {
        this.selectedRows = [];
        this.dialogModel.dialogMode = false;
        this.onUserValueFilter(result)
      }
    });

    this.dialogRef.content.instance.cancel.subscribe((result) => {
      this.dialogModel.dialogMode = false;
      this.dialogRef.close();
    });
  }

  onUserValueFilter(data) {
    console.log(data);
    if (data.dataItem) {
      this.userValueFilter = [];
      this.userValueFilter.push(
        new Filter("bankName",
            data.dataItem.value,
            "== {0}",
            "System.String"
          )
      );
      this.defaultFilter = this.userValueFilter;
      this.searchValue = data.dataItem.value;
      this.reloadGrid();
      this.dialogRef.close();
    }
  }
}