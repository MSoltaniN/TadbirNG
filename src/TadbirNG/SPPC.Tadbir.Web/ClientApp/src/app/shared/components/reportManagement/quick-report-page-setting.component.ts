import { Component, OnInit, Output, EventEmitter, Renderer2, ChangeDetectorRef, NgZone, ElementRef } from '@angular/core';
import { DialogService, DialogRef } from '@progress/kendo-angular-dialog';
import { ToastrService } from 'ngx-toastr';
import { TranslateService } from '@ngx-translate/core';
import { GridService, BrowserStorageService, MetaDataService } from '@sppc/shared/services';
import { SettingService } from '@sppc/config/service';
import { AutoGeneratedGridComponent, DetailComponent } from '@sppc/shared/class';
import { Layout } from '@sppc/shared/enum/metadata';
import { RTL } from '@progress/kendo-angular-l10n';
import { PageSizeResource, PageSize, PageOrientation, PageOrientationResource } from '@sppc/shared/enum/pageSetting';
import { Item } from '@sppc/shared/models';
import { ReportPageSetting } from '@sppc/shared/models/reportPageSetting';

export function getLayoutModule(layout: Layout) {
  return layout.getLayout();
}

@Component({
  selector: 'quick-report-page-setting',
  templateUrl: './quick-report-page-setting.component.html',
  styleUrls: ['./quick-report-page-setting.component.css'],
  providers: [{
    provide: RTL,
    useFactory: getLayoutModule,
    deps: [Layout]
  }]
})
export class QuickReportPageSettingComponent extends DetailComponent implements OnInit  {

  pageSizes: Array<Item> = [    
    { value: PageSizeResource.A4, key: PageSize.A4 },
    { value: PageSizeResource.A3, key: PageSize.A3 }
  ];

  pageOrientations: Array<Item> = [
    { value: PageOrientationResource.Portrait, key: PageOrientation.Portrait },
    { value: PageOrientationResource.Landscape, key: PageOrientation.Landscape },    
  ]

  @Output() result: EventEmitter<any> = new EventEmitter();
  @Output() cancel: EventEmitter<any> = new EventEmitter();

  dialogRef: DialogRef;
  dialogModel: any;   

  columnFitPage: boolean = true;
  pageSizeSelected: string;// = "A4";
  pageOrientationSelected: string = "Portrait";
  bottomMargin: number = 0;
  topMargin: number = 0;
  leftMargin: number = 0;
  rightMargin: number = 0;

  min: number = 0;
  max: number = 6;

  constructor(public bStorageService: BrowserStorageService,
    public toastrService: ToastrService, public translate: TranslateService,
    public renderer: Renderer2, public metadata: MetaDataService, public settingService: SettingService,public elem:ElementRef) {

    super(toastrService, translate, bStorageService, renderer, metadata, '', 0,elem);
  }

  ngOnInit() {

  }

  onCancel(): void {
    this.cancel.emit();
  }

  onSave(): void {

    var reportSetting = new ReportPageSetting();
    reportSetting.columnFitPage = this.columnFitPage;
    reportSetting.marginBottom = this.bottomMargin;
    reportSetting.marginLeft = this.leftMargin;
    reportSetting.marginRight = this.rightMargin;
    reportSetting.marginTop = this.topMargin;
    reportSetting.pageOrientation = this.pageOrientationSelected;
    reportSetting.pageSize = this.pageSizeSelected;

    this.result.emit(reportSetting);
  }  

  escPress() {
    this.onCancel();
  }

}
