<section class="content-header col-md-12">
  <div class="col-md-12 col-lg-2 col-xs-12 title">
    <h2>
      {{ "Dashboard.DashboardTitle" | translate }}
    </h2>
  </div>
  <div class="col-md-12 col-lg-10 col-xs-12 settings">
    <div
      class="buttons"
      [ngClass]="isDashboardEditMode ? 'col-lg-7 col-md-6' : 'col-md-12'"
    >
      <a href="#/tadbir/dashboard" (click)="onManageWidgetsClick()">
        <i class="fa fa-cubes"></i>{{ "Dashboard.ManageWidgets" | translate }}
      </a>
      <a href="#/tadbir/dashboard" *ngIf="this.currentDashboard" (click)="onAddTabClick()">
        <i class="fa fa-plus"></i>{{ "Dashboard.AddTab" | translate }}
      </a>
      <a href="#/tadbir/dashboard" (click)="onAddWidgetClick()">
        <i class="fa fa-plus"></i>{{ "Dashboard.AddWidget" | translate }}
      </a>
      <a
        href="#/tadbir/dashboard"
        *ngIf="!isDashboardEditMode"
        (click)="onSettingClick()"
      >
        <i class="fa fa-cog"></i>{{ "Dashboard.Setting" | translate }}
      </a>
    </div>
    <ng-template [ngIf]="isDashboardEditMode">
      <div
        class="alert alert-warning msg-container"
        [ngClass]="isDashboardEditMode ? 'col-lg-5 col-md-6' : ''"
      >
        <div class="dashboard-button">
          <button (click)="onOkClick()" class="k-button k-primary">
            {{ "Buttons.Ok" | translate }}
          </button>
        </div>
        <div class="dashboard-button">
          <button (click)="onCancelClick()" class="k-button k-primary">
            {{ "Buttons.Cancel" | translate }}
          </button>
        </div>
        <div class="col-md-8 confirm-msg">
          <span>{{ "Dashboard.SettingConfirm" | translate }}</span>
        </div>
      </div>
    </ng-template>
  </div>
</section>

<!-- Main content -->
<section class="content clear" style="padding-top: 0;">  
  <div class="row widgets">
    <div style="height: 100vh; width: 100%; direction: ltr">
      <p-tabView #tabContainer        
        (onChange)="onTabChange($event)"
        *ngIf="currentDashboard"
        [(activeIndex)]="currentDashboardTabIndex"
      >
        <p-tabPanel
          [header]="tab.title"   
          [id]="tab.id"       
          *ngFor="
            let tab of currentDashboard.tabs;
            let i = index;
            let firstIndex = first
          "
        >
          <ng-template pTemplate="header">
            <span (click)="removeTab(tab.id)" *ngIf="isDashboardEditMode">
              <i class="fa fa-trash remove-tab"></i>
            </span>
            <span class="tab-title">{{ tab.title }}</span>
          </ng-template>
          <ng-container *ngIf="getWidgets(tab.id) | async as widgets">
            <gridster [options]="widgetOptions[tab.id]">
              <gridster-item [item]="item" *ngFor="let item of widgets">
                <ng-container *ngIf="item.typeId == 2 || item.typeId == 1 || item.typeId == 3">                 
                  <widget
                    (closeWidget)="onCloseWidget($event)"
                    [widgetId]="item.id"
                    [isEditMode]="isDashboardEditMode"
                    [headerTitle]="item.title"
                    [setting]="widgetSettings[item.id + '-' + tab.id]"
                  >
                    <widget-container>
                      <div class="box-body" body>
                        <chart-widget
                          [data]="widgetData[item.id + '-' + tab.id]"
                          [type]="dashboardService.getChartType(item.typeId)"
                          [options]="getOptions(item.typeId)"
                        ></chart-widget>
                      </div>
                    </widget-container>
                  </widget>
                </ng-container>
              </gridster-item>
            </gridster>
          </ng-container>
        </p-tabPanel>
      </p-tabView>
      <!-- <ng-container *ngIf="getWidgets(1) | async as widgets">
        <gridster [options]="options">
          <gridster-item [item]="item" *ngFor="let item of widgets">
            <ng-container *ngIf="item.typeId == 0">
              <widget
                (closeWidget)="onCloseWidget($event)"
                [widgetId]="item.id"
                [isEditMode]="isDashboardEditMode"
                [headerTitle]="item.title"
              >
                <widget-container>
                  <div class="box-body" body>
                    <chart-widget
                      [type]="'bar'"
                      [data]="grossChartData"
                      [options]="basicOptions"
                    ></chart-widget>
                  </div>
                </widget-container>
              </widget>
            </ng-container>
          </gridster-item>
        </gridster>
      </ng-container> -->
    </div>
  </div>
  <ng-template #chart1>
    <widget
      (closeWidget)="onCloseWidget($event)"
      [widgetId]="1"
      [isEditMode]="isDashboardEditMode"
      headerTitle="{{ 'Dashboard.GrossSales' | translate }}"
    >
      <widget-container>
        <div class="box-body" body>
          <chart-widget
            [type]="'bar'"
            [data]="grossChartData"
            [options]="basicOptions"
          ></chart-widget>
        </div>
      </widget-container>
    </widget>
  </ng-template>
  <ng-template #chart2>
    <widget
      (closeWidget)="onCloseWidget($event)"
      [widgetId]="2"
      [isEditMode]="isDashboardEditMode"
      headerTitle="{{ 'Dashboard.NetSales' | translate }}"
    >
      <widget-container>
        <div class="box-body" body>
          <chart-widget
            [type]="'bar'"
            [data]="netChartData"
            [options]="basicOptions"
          ></chart-widget>
        </div>
      </widget-container>
    </widget>
  </ng-template>
  <ng-template #guage>
    <div class="col-sm-12 col-md-3 guage">
      <kendo-radialgauge
        [pointer]="{ value: liquidRatio }"
        [scale]="{ max: 4000 }"
      >
      </kendo-radialgauge>
    </div>
  </ng-template>
</section>
