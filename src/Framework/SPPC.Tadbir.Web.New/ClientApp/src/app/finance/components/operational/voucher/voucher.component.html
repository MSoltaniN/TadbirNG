
<view-identifier [ViewID]="2">
  <report-param ParamName='FromDate' [ParamValue]="startDate"></report-param>
  <report-param ParamName='ToDate' [ParamValue]="endDate"></report-param>
</view-identifier>

<report-viewer id='compviewer'></report-viewer>
<report-management [ViewIdentity]="viewIdentity" [Grid]="grid" [Sort]="sort"
                   [Filter]="reportFilter" [RowData]="rowData" [MetadataType]="metadataType"></report-management>

<app-bread-cumb [entityTypeName]="entityTypeName"></app-bread-cumb>

<div class="panel-body">
  <kendo-grid id="{{viewId}}"
              #GridID [ngClass]="{'tRtl':this.currentlang === 'fa' , 'tLtr': this.currentlang === 'en'}"
              [data]="rowData"
              [sortable]="{ allowUnsort: true, mode: 'multiple' }"
              [sort]="sort"
              [pageSize]="pageSize"
              [skip]="skip"
              [filter]="state.filter"
              [pageable]="true"
              [resizable]="true"
              [filterable]="true"
              [scrollable]="'scrollable'"
              (pageChange)="pageChange($event)"
              (sortChange)="sortChange($event)"
              (edit)="editHandler($event)"
              (remove)="removeHandler($event)"
              [loading]="false"
              [selectable]="{ checkboxOnly: true, mode: 'multiple' }"
              [selectedKeys]="selectedRows"
              [kendoGridSelectBy]="selectionKey"
              (filterChange)="filterChange($event)"
              (selectedKeysChange)="onSelectedKeysChange($event)"
              (dataStateChange)="onDataStateChange()"
              (cellClick)="onCellClick($event)"
              (dblclick)="rowDoubleClickHandler()"
              sppc-auto-generated-grid-reorder
              sppc-auto-generated-grid-resize>

    <ng-template kendoGridNoRecordsTemplate>
      {{ showloadingMessage  ? ('App.Loading' | translate) : ('App.RecordNotFound' | translate) }}
    </ng-template>

    <kendo-grid-messages pagerPage="{{ 'Paging.Record' | translate }}"
                         pagerOf="{{ 'Paging.Of' | translate }}"
                         pagerItems="{{ 'Paging.Record' | translate }}"
                         pagerItemsPerPage="{{ 'Paging.ItemsPerPage' | translate }}">
    </kendo-grid-messages>

    <ng-template kendoPagerTemplate>
      <kendo-pager-prev-buttons></kendo-pager-prev-buttons>
      <kendo-pager-info></kendo-pager-info>
      <kendo-pager-numeric-buttons [buttonCount]="5"></kendo-pager-numeric-buttons>
      <kendo-pager-next-buttons></kendo-pager-next-buttons>
      <kendo-pager-page-sizes [pageSizes]="pageSizeArray"></kendo-pager-page-sizes>
    </ng-template>

    <ng-template kendoGridToolbarTemplate>
      <div class="row">
        <div class="col-xs-12 col-sm-6 sppc-float">
          <sppc-dateRangeSelector [viewName]="'voucher'" (valueChange)="dateValueChange($event)"></sppc-dateRangeSelector>
        </div>
      </div>

      <button kendoGridAddCommand SppcPermissionCheck="Create" (sppcClick)="addNew()" [icon]="'file-add'" type="button" title="{{ 'Voucher.New' | translate }}"></button>

      <button SppcPermissionCheck="Edit" (sppcClick)="editHandler()" class="k-button k-button-icon" [disabled]="selectedRows.length != 1" title="{{ 'Buttons.Edit' | translate }}"><span class="k-icon k-i-pencil"></span></button>
      <button SppcPermissionCheck="Delete" (sppcClick)="removeHandler()" class="k-button k-button-icon" [disabled]="selectedRows.length == 0" title="{{ 'Buttons.Delete' | translate }}"><span class="k-icon k-i-delete"></span></button>

      <button *ngIf="groupOperation"  SppcPermissionCheck="GroupCheck;ManageVouchersPermissions" EntityName="Vouchers" (sppcClick)="onCheckHandler()" class="k-button k-button-icon"
              title="{{ (commitGroup ? 'Voucher.CommitGroup':'Voucher.Commit') | translate}}">
        <span class="k-icon k-i-check-outline"></span>
      </button>
      <button *ngIf="!groupOperation" SppcPermissionCheck="Check" (sppcClick)="onCheckHandler()" class="k-button k-button-icon"
              title="{{ (commitGroup ? 'Voucher.CommitGroup':'Voucher.Commit') | translate}}">
        <span class="k-icon k-i-check-outline"></span>
      </button>

      <button *ngIf="groupOperation" SppcPermissionCheck="UndoCheck" (sppcClick)="onUnCheckHandler()" class="k-button k-button-icon"
              title="{{ (returnFromCommitGroup ? 'Voucher.ReturnFromCommitGroup':'Voucher.ReturnFromCommit') | translate}}">
        <span class="k-icon k-i-close-outline"></span>
      </button>
      <button *ngIf="!groupOperation" SppcPermissionCheck="GroupUndoCheck;ManageVouchersPermissions" EntityName="Vouchers" (sppcClick)="onUnCheckHandler()" class="k-button k-button-icon"
              title="{{ (returnFromCommitGroup ? 'Voucher.ReturnFromCommitGroup':'Voucher.ReturnFromCommit') | translate}}">
        <span class="k-icon k-i-close-outline"></span>
      </button>

      <button *ngIf="groupOperation" SppcPermissionCheck="GroupFinalize;ManageVouchersPermissions" EntityName="Vouchers" (sppcClick)="onFinalizeHandler()" class="k-button k-button-icon"
              title="{{ (finalizedGroup ? 'Voucher.FinalizedGroup':'Voucher.Finalized') | translate}}">
        <span class="k-icon k-i-track-changes-accept-all"></span>
      </button>
      <button *ngIf="!groupOperation" SppcPermissionCheck="Finalize" (sppcClick)="onFinalizeHandler()" class="k-button k-button-icon"
              title="{{ (finalizedGroup ? 'Voucher.FinalizedGroup':'Voucher.Finalized') | translate}}">
        <span class="k-icon k-i-track-changes-accept-all"></span>
      </button>
      <div [style.display]="showFinancBtns ? 'inline-block' : 'none'">
        <button *ngIf="groupOperation"  (click)="onUnFinalizedHandler()" class="k-button k-button-icon"
                title="{{ (returnFromFinalizedGroup ? 'Voucher.ReturnFromFinalizedGroup':'Voucher.ReturnFromFinalized') | translate}}">
          <span class="k-icon k-i-track-changes-reject-all"></span>
        </button>
        <button *ngIf="!groupOperation" (click)="onUnFinalizedHandler()" class="k-button k-button-icon"
                title="{{ (returnFromFinalizedGroup ? 'Voucher.ReturnFromFinalizedGroup':'Voucher.ReturnFromFinalized') | translate}}">
          <span class="k-icon k-i-track-changes-reject-all"></span>
        </button>
      </div>
      <button SppcPermissionCheck="GroupConfirm;ManageVouchersPermissions" EntityName="Vouchers" (sppcClick)="onConfirmGroupHandler()" class="k-button k-button-icon"
              title="{{'Voucher.ConfirmGroup'| translate}}" >
        <span class="k-icon k-i-lock"></span>
      </button>


      <button SppcPermissionCheck="UndoConfirm" (sppcClick)="onUnConfirmGroupHandler()" class="k-button k-button-icon"
              title="{{'Voucher.UnConfirmGroup'| translate}}">
        <span class="k-icon k-i-unlock"></span>
      </button>



      <auto-generated-grid-setting [entityTypeName]="entityTypeName"
                                   (columnsList)="getColumns($event)">
      </auto-generated-grid-setting>
      <grid-filter *ngIf="this.grid.filterable" [parentComponent]="this" [showClearFilter]="this.grid.filter.filters.length"></grid-filter>


    </ng-template>

    <kendo-grid-checkbox-column showSelectAll="true"
                                [headerClass]="{'chb-column': true}"
                                [class]="{'chb-column': true}"
                                [resizable]="false"
                                [reorderable]="false">
    </kendo-grid-checkbox-column>

    <kendo-grid-column media="(max-width: 450px)" title="">
      <ng-template kendoGridCellTemplate let-dataItem>
        <dl>
          <ng-template ngFor let-item [ngForOf]="gridColumns" let-i="index">
            <dt>{{ getColumnTitle(item) }}:</dt>
            <dd *ngIf="item.type == 'Money'" class="dl-value">{{ getRowValue(item.name,dataItem,item.scriptType) | SppcNumConfig | async }}</dd>
            <dd *ngIf="item.scriptType != 'Date' && item.type != 'Money'" class="dl-value">{{ getRowValue(item.name,dataItem,item.scriptType) }}</dd>
            <dd *ngIf="item.scriptType == 'Date'" class="dl-value">{{ getRowValue(item.name,dataItem,item.scriptType) | SppcDate }}</dd>
          </ng-template>
        </dl>

      </ng-template>
    </kendo-grid-column>

    <kendo-grid-column media="(min-width: 450px)" *ngFor="let item of gridColumns" sppc-auto-grid-column="{{ item.settings }}">

      <ng-template kendoGridFilterCellTemplate let-filter let-column="column">
        <sppc-auto-grid-filter [metaDataItem]="item" [metaData]="item.scriptType" [column]="column" [filter]="filter"></sppc-auto-grid-filter>
      </ng-template>

      <ng-template kendoGridCellTemplate let-dataItem *ngIf="item.scriptType == 'Date'">
        {{ getRowValue(item.name,dataItem,item.scriptType) | SppcDate  }}
      </ng-template>

      <ng-template kendoGridCellTemplate let-dataItem *ngIf="item.scriptType == 'boolean' && item.name=='IsConfirmed' || item.name=='IsApproved' || item.name=='IsConfirmed' ">
        {{ getVerifidAndapproveValue(item.name,dataItem,item.scriptType)  }}
      </ng-template>

      <ng-template kendoGridCellTemplate let-dataItem *ngIf="item.scriptType == 'boolean' && item.name!='IsBalanced' && item.name!='IsApproved' && item.name!='IsConfirmed' ">
        {{ getRowValue(item.name,dataItem,item.scriptType)  }}
      </ng-template>

      <ng-template kendoGridCellTemplate let-dataItem *ngIf="item.scriptType == 'boolean' && item.name=='IsBalanced'">
        {{ getBalanceValue(item.name,dataItem,item.scriptType)  }}
      </ng-template>

      <ng-template kendoGridCellTemplate let-dataItem *ngIf="item.type == 'Money'">
        {{ getRowValue(item.name,dataItem,item.type) | SppcNumConfig | async }}
      </ng-template>

    </kendo-grid-column>

  </kendo-grid>

  <div class="col-xs-12 col-sm-4 form-group">
    <button class="k-button k-primary sppc-float-diff" (click)="getVouchers()" style="margin-top: 25px;">
      {{ 'Buttons.Compute' | translate }}
    </button>
  </div>

  <div class="col-xs-12 col-sm-5 form-group " style="margin-top: 25px;" [ngClass]="{'pull-right':this.CurrentLanguage === 'fa'}">
    <label class="control-label" style="padding:10px">{{ 'Voucher.SelectBranch' | translate }}</label>

    <kendo-dropdownlist [data]="branchScope" class="ddl-type"
                        [textField]="'value'"
                        [valueField]="'key'"
                        [valuePrimitive]="true"
                        [value]="branchSelected"
                        [(ngModel)]="branchSelected"
                        (ngModelChange)="changeParam();">
      <ng-template kendoDropDownListValueTemplate let-dataItem>
        {{ dataItem?.value | translate }}
      </ng-template>
      <ng-template kendoDropDownListItemTemplate let-dataItem>
        {{ dataItem?.value | translate }}
      </ng-template>
    </kendo-dropdownlist>
  </div>

</div>

<kendo-dialog title="{{'Voucher.Delete' | translate}}" *ngIf="deleteConfirm" (close)="deleteModel(false)" [minWidth]="250" [width]="450">
  <p>
    {{ this.deleteConfirmMsg }}
  </p>
  <kendo-dialog-actions>
    <button class="k-button" (click)="deleteModel(true)" primary="true">{{ 'Buttons.Yes' | translate }}</button>
    <button class="k-button" (click)="deleteModel(false)">{{ 'Buttons.No' | translate }}</button>
  </kendo-dialog-actions>
</kendo-dialog>

<kendo-dialog title="{{'Voucher.ModalTitle' | translate}}" *ngIf="UnConfirmGroupConfirm" (close)="UnGroupConfirmModel(false)" [minWidth]="450" [width]="620">
  <p>
    {{ 'Voucher.UnConfirmGroupMsg' | translate }}

    <span class="k-icon k-i-question k-i-help" style="font-size: 40px;color: #0e99da;"></span>
    <br />
    {{'Voucher.AreYouAgree' | translate}}
  </p>
  <kendo-dialog-actions>
    <button class="k-button" (click)="UnGroupConfirmModel(true)" primary="true">{{ 'Buttons.Yes' | translate }}</button>
    <button class="k-button" (click)="UnGroupConfirmModel(false)">{{ 'Buttons.No' | translate }}</button>
  </kendo-dialog-actions>
</kendo-dialog>

<kendo-dialog title="{{'Voucher.GetPasssordModalTitle' | translate}}" *ngIf="showGetPasswordModal" (close)="getPasswordModel(false)" [minWidth]="450" [width]="620">
  <div class="col-sm-10ths col-xs-12 sppc-float">
    <div class="form-group">
      <label for="no" class="control-label">{{ 'Voucher.Password' | translate }}</label>
      <input type="password" class="k-textbox" id="specialPassword" style="width:80%" [(ngModel)]="value" (ngModelChange)="onPasswordChange($event)" required />

    </div>
  </div>
  <kendo-dialog-actions>
    <button class="k-button" (click)="getPasswordModel(true)" primary="true" [disabled]="showErrorMessage">{{ 'Buttons.Ok' | translate }}</button>
    <button class="k-button" (click)="getPasswordModel(false)">{{ 'Buttons.Cancel' | translate }}</button>
  </kendo-dialog-actions>
</kendo-dialog>
