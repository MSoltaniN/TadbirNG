<view-identifier [ViewID]="viewId">
  <report-param ParamName='VoucherId' [ParamValue]="voucherId"></report-param>
</view-identifier>
<report-viewer id='compviewer'></report-viewer>
<report-management [ViewIdentity]="viewIdentity" [Grid]="grid" [Sort]="sort"
                   [Filter]="currentFilter" [RowData]="rowData" [MetadataType]="metadataType" (onDataBind)="onReportDataBind($event)"></report-management>
<div class="voucher-line">
  <div class="">

    <kendo-grid id="{{viewId}}" data-metadataType="{{this.metadataType}}"
                style="width:100%;"
                #GridID [ngClass]="{'tRtl':this.currentlang === 'fa' , 'tLtr': this.currentlang === 'en'}"
                [data]="rowData"
                [sortable]="{ allowUnsort: true, mode: 'multiple' }"
                [sort]="sort"
                [pageSize]="pageSize"
                [skip]="skip"
                [filter]="state.filter"
                [pageable]="true"
                [resizable]="true"
                [filterable]="true"
                [scrollable]="'scrollable'"
                (pageChange)="pageChange($event)"
                (sortChange)="sortChange($event)"
                (edit)="editHandler()"
                (remove)="removeHandler()"
                [loading]="false"
                [selectable]="{ checkboxOnly: true, mode: 'multiple' }"
                [selectedKeys]="selectedRows"
                [kendoGridSelectBy]="selectionKey"
                (filterChange)="filterChange($event)"
                (selectedKeysChange)="onSelectedKeysChange($event)"
                (dataStateChange)="onDataStateChange()"
                sppc-auto-generated-grid-reorder
                sppc-auto-generated-grid-resize>
      <kendo-grid-messages pagerPage="{{ 'Paging.Record' | translate }}"
                           pagerOf="{{ 'Paging.Of' | translate }}"
                           pagerItems="{{ 'Paging.Record' | translate }}">
      </kendo-grid-messages>
      <ng-template kendoGridNoRecordsTemplate>
        {{ showloadingMessage  ? ('App.Loading' | translate) : ('App.RecordNotFound' | translate) }}
      </ng-template>
      <ng-template kendoGridToolbarTemplate>

        <button kendoGridAddCommand (click)="addNew()" [hidden]="documentStatus != documentStatusValue.Draft" [icon]="'file-add'" type="button" title="{{ 'VoucherLine.New' | translate }}"></button>

        <button kendoGridAddCommand [hidden]="documentStatus != documentStatusValue.Draft" [icon]="'plus-outline'" *ngIf="balance != 0" class="k-button" (click)="addNewWithBalance()" type="button">{{ 'VoucherLine.NewWithDifference' | translate }}</button>
        <button *ngIf="groupDelete" [hidden]="documentStatus != documentStatusValue.Draft" class="k-button" (click)="deleteModels()" type="button">{{ 'Buttons.GroupDelete' | translate }}</button>

        <auto-generated-grid-setting [metadataType]="metadataType"
                                     [entityTypeName]="entityTypeName"
                                     [metadataUrlType]="metadataUrlType"
                                     (columnsList)="getColumns($event)">
        </auto-generated-grid-setting>
        <grid-filter *ngIf="this.grid.filterable" [parentComponent]="this" [showClearFilter]="this.grid.filter.filters.length"></grid-filter>
        <button kendoButton (click)="showReport()" class="reportMargin" type="button" [icon]="'printer'"></button>
      </ng-template>

      <kendo-grid-checkbox-column showSelectAll="true" width="50"></kendo-grid-checkbox-column>


      <kendo-grid-column media="(max-width: 450px)" title="">
        <ng-template kendoGridCellTemplate let-dataItem>
          <dl>
            <ng-template ngFor let-item [ngForOf]="gridColumns" let-i="index">
              <dt>{{ getColumnTitle(item.name) }}:</dt>
              <dd *ngIf="item.type == 'Money'" class="dl-value">{{ getRowValue(item.name,dataItem,item.scriptType) | SppcNumConfig | async }}</dd>
              <dd *ngIf="item.scriptType != 'Date' && item.type != 'Money'" class="dl-value">{{ getRowValue(item.name,dataItem,item.scriptType) }}</dd>
              <dd *ngIf="item.scriptType == 'Date'" class="dl-value">{{ getRowValue(item.name,dataItem,item.scriptType) | SppcDate }}</dd>
            </ng-template>
          </dl>

        </ng-template>

      </kendo-grid-column>

      <kendo-grid-column media="(min-width: 450px)" *ngFor="let item of gridColumns" width="{{getColumnWidth(item)}}" sppc-grid-column="{{ entityTypeName }}.{{ item.name }}">

        <ng-template kendoGridFilterCellTemplate let-filter let-column="column">
          <sppc-grid-filter [metaData]="getMetaData(item.name)" [column]="column" [filter]="filter"></sppc-grid-filter>
        </ng-template>

        <ng-template kendoGridCellTemplate let-dataItem *ngIf="item.scriptType == 'Date'">
          {{ getRowValue(item.name,dataItem,item.scriptType) | SppcDate  }}
        </ng-template>

        <ng-template kendoGridCellTemplate let-dataItem *ngIf="item.scriptType == 'boolean'">
          {{ getRowValue(item.name,dataItem,item.scriptType)  }}
        </ng-template>

        <ng-template kendoGridCellTemplate let-dataItem *ngIf="item.type == 'Money'">
          {{ getRowValue(item.name,dataItem,item.type) | SppcNumConfig | async }}
        </ng-template>

      </kendo-grid-column>

    </kendo-grid>



  </div>

  <div class="row" style="margin-top: 10px;">

    <div class="col-xs-12 col-sm-4 sppc-float">
      <div class="form-group">
        <label class="control-label">مجموع بدهکار</label>

        <input type="text" class="k-textbox" [ngModel]="debitSum | SppcNumConfig | async" readonly />
      </div>
    </div>

    <div class="col-xs-12 col-sm-4 sppc-float">
      <div class="form-group">
        <label class="control-label">مجموع بستانکار</label>

        <input type="text" class="k-textbox" [ngModel]="creditSum | SppcNumConfig | async" readonly />
      </div>
    </div>

    <div class="col-xs-12 col-sm-4 sppc-float">
      <div class="form-group">
        <label class="control-label">اختلاف</label>

        <input type="text" class="k-textbox" [ngModel]="balance | SppcNumConfig | async" readonly />
      </div>
    </div>

  </div>

  <div *ngIf="selectedRows.length == 1" style="border-top:solid 1px #3c8dbc">
    <div class="row article-account">
      <div class="col-xs-12">
        <label class="control-label">حساب</label>
        <label class="control-label" style="text-align: center; direction: ltr;">
          {{ selectedModel.fullAccount.account.fullCode }} -
          {{ selectedModel.fullAccount.detailAccount.fullCode }} -
          {{ selectedModel.fullAccount.costCenter.fullCode }} -
          {{ selectedModel.fullAccount.project.fullCode }}
        </label>
        <input type="text" class="k-textbox sppc-float" [ngModel]="selectedModel.fullAccount.account.name" readonly />
        <input type="text" class="k-textbox sppc-float" [ngModel]="selectedModel.fullAccount.detailAccount.name" readonly />
        <input type="text" class="k-textbox sppc-float" [ngModel]="selectedModel.fullAccount.costCenter.name" readonly />
        <input type="text" class="k-textbox sppc-float" [ngModel]="selectedModel.fullAccount.project.name" readonly />
      </div>
    </div>

    <div class="row article-description">
      <div class="col-xs-12">
        <label class="control-label">شرح آرتیکل</label>
        <input type="text" class="k-textbox" [ngModel]="selectedModel.description" readonly />
      </div>
    </div>

    <div class="row" style="margin: 25px 0;">
      <div class="col-xs-12">
        <div class="k-form-field">

          <div class="article-status-item">
            <input type="checkbox" id="issuedBy" class="k-checkbox right"
                   [(ngModel)]="issuedBy" />
            <label class="k-checkbox-label right" for="issuedBy">تنظیم کننده</label>

            <input type="text" class="k-textbox" />

          </div>

          <div class="article-status-item">
            <input type="checkbox" id="confirmedBy" class="k-checkbox"
                   [(ngModel)]="confirmedBy" />
            <label class="k-checkbox-label" for="confirmedBy">تایید کننده</label>

            <input type="text" class="k-textbox" />
          </div>

          <div class="article-status-item">
            <input type="checkbox" id="approvedBy" class="k-checkbox"
                   [(ngModel)]="approvedBy" />
            <label class="k-checkbox-label" for="approvedBy">تصویب کننده</label>

            <input type="text" class="k-textbox" />
          </div>
        </div>
      </div>
    </div>

  </div>

  <kendo-dialog title="{{'VoucherLine.Delete' | translate}}" *ngIf="deleteConfirm" (close)="deleteModel(false)" [minWidth]="250" [width]="450">
    <p>
      {{ deleteConfirmMsg }}
    </p>
    <kendo-dialog-actions>
      <button class="k-button" (click)="deleteModel(true)" primary="true">{{ 'Buttons.Yes' | translate }}</button>
      <button class="k-button" (click)="deleteModel(false)">{{ 'Buttons.No' | translate }}</button>
    </kendo-dialog-actions>
  </kendo-dialog>
</div>
<report-viewer id='compviewer' baseId='6'></report-viewer>
